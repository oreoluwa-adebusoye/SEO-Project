{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">

  <!-- Welcome -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-1">Welcome back, {{ username or 'Friend' }} ðŸ‘‹</h3>
      <small class="text-muted">Find events and people near you.</small>
    </div>
    <div class="d-flex gap-2">
      <form method="get" action="{{ url_for('events') }}" class="d-flex gap-2">
        <input name="location" class="form-control form-control-sm" placeholder="City" />
        <select name="category" class="form-select form-select-sm">
          <option value="">All</option>
          <option>Music</option>
          <option>Tech</option>
          <option>Outdoors</option>
        </select>
        <button class="btn btn-primary btn-sm">Search</button>
      </form>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <a href="{{ url_for('create_event') if false else '#' }}" class="text-decoration-none">
        <div class="card shadow-sm p-3 h-100">
          <h6 class="mb-1">Create an event</h6>
          <small class="text-muted">Host something and invite others.</small>
        </div>
      </a>
    </div>
    <div class="col-md-4">
      <a href="{{ url_for('events') }}" class="text-decoration-none">
        <div class="card shadow-sm p-3 h-100">
          <h6 class="mb-1">Find events near me</h6>
          <small class="text-muted">Browse whatâ€™s happening around you.</small>
        </div>
      </a>
    </div>
    <div class="col-md-4">
      <a href="{{ url_for('profile') if false else '#' }}" class="text-decoration-none">
        <div class="card shadow-sm p-3 h-100">
          <h6 class="mb-1">Edit profile</h6>
          <small class="text-muted">Update your interests & bio.</small>
        </div>
      </a>
    </div>
  </div>

  <!-- Events: Tabs -->
  <ul class="nav nav-tabs" id="eventsTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#community" type="button">Community Events</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#ticketmaster" type="button">Ticketmaster</button>
    </li>
  </ul>
  <div class="tab-content pt-3 mb-4">
    
    <!-- Community Events -->
    <div class="tab-pane fade show active" id="community">
      <div class="row">
        {% for e in community_events or [] %}
        <div class="col-md-4 mb-3">
          <div class="card h-100 shadow-sm">
            {% if e.image %}<img src="{{ e.image }}" class="card-img-top" alt="event">{% endif %}
            <div class="card-body">
              <h6 class="card-title">{{ e.title }}</h6>
              <small class="text-muted">{{ e.date }} â€¢ {{ e.location }}</small>
              <div class="mt-2">
                <a href="{{ url_for('event', event_id=e.id) }}" class="btn btn-sm btn-outline-primary">View</a>
              </div>
            </div>
          </div>
        </div>
        {% else %}
        <p class="text-muted">No community events yet.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Ticketmaster Events -->
    <div class="tab-pane fade" id="ticketmaster">
      <div class="row">
        {% for e in tm_events or [] %}
        <div class="col-md-4 mb-3">
          <div class="card h-100 shadow-sm">
            {% if e.image %}<img src="{{ e.image }}" class="card-img-top" alt="event">{% endif %}
            <div class="card-body">
              <h6 class="card-title">{{ e.title }}</h6>
              <small class="text-muted">{{ e.date }} â€¢ {{ e.venue }}</small>
              <div class="mt-2">
                <a href="{{ e.url }}" target="_blank" class="btn btn-sm btn-outline-primary">Tickets</a>
              </div>
            </div>
          </div>
        </div>
        {% else %}
        <p class="text-muted">No Ticketmaster events found.</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Suggested People -->
  <div class="mb-4">
    <h5 class="mb-2">People you might meet</h5>
    <div class="d-flex flex-wrap gap-3">
      {% for p in suggested_people or [] %}
      <div class="text-center">
        <img src="{{ p.avatar_url or 'https://source.unsplash.com/80x80/?portrait' }}" class="rounded-circle mb-1" width="64" height="64">
        <div class="small">{{ p.name }}</div>
      </div>
      {% else %}
      <p class="text-muted">Weâ€™ll suggest people once you join a few events.</p>
      {% endfor %}
    </div>
  </div>

  <!-- Messages preview -->
  <div class="mb-5">
    <h5 class="mb-2">Recent messages</h5>
    <div class="list-group">
      {% for c in recent_chats or [] %}
      <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
         href="{{ url_for('messages', chat_id=c.id) }}">
        <div>
          <strong>{{ c.name }}</strong>
          <div class="small text-muted">{{ c.last_message }}</div>
        </div>
        <span class="badge bg-primary rounded-pill">{{ c.unread or 0 }}</span>
      </a>
      {% else %}
      <div class="text-muted">No messages yet.</div>
      {% endfor %}
    </div>
  </div>

</div>
{% endblock %}
