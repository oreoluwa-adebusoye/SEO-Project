{% extends "layout.html" %}
{% block title %}Home | Gather{% endblock %}
{% block content %}
<div class="container py-4">

  <!-- Top: Welcome + CTAs -->
  <div class="card p-4 mb-4">
    <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3">
      <div>
        <h3 class="mb-1">Hey {{ me.username.split(' ')[0] if me.username else 'there' }} üëã</h3>
        <div class="text-muted">Find an event, then meet people going too.</div>
      </div>
      <div class="d-flex flex-wrap gap-2">
        <a class="btn btn-primary" href="{{ url_for('events') }}"><i class="bi bi-calendar2-event me-2"></i>Explore Events</a>
        <a class="btn btn-outline-primary" href="{{ url_for('profile_view', username=me.username) }}"><i class="bi bi-person-badge me-2"></i>View Profile</a>
        <a class="btn btn-outline-primary" href="{{ url_for('create_event') }}"><i class="bi bi-plus-circle me-2"></i>Create Event</a>
        <a class="btn btn-outline-primary" href="{{ url_for('messages_index') }}"><i class="bi bi-chat-dots me-2"></i>Messages ({{ unread }})</a>
      </div>
    </div>
  </div>

  <div class="row g-4">

    <!-- People to meet -->
    <div class="col-lg-7">
      <div class="card p-3 h-100">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">People to meet</h5>
          <a class="small link-muted" href="{{ url_for('people') }}">See all</a>
        </div>

        {% if not suggestions %}
          <div class="text-muted">RSVP to events or add interests on your profile to get suggestions.</div>
        {% else %}
          <div class="row g-3">
            {% for u in suggestions %}
              <div class="col-md-6">
                <div class="card p-3 h-100 d-flex">
                  <div class="d-flex align-items-center gap-3">
                    <img src="{{ u.avatar_url or 'https://via.placeholder.com/64' }}" width="64" height="64" class="rounded-circle object-cover" alt="">
                    <div>
                      <div class="fw-semibold">{{ u.username }}</div>
                      {% if u.school %}<div class="text-muted small">{{ u.school }}</div>{% endif %}
                      {% if u.interests %}<div class="text-muted small">Interests: {{ u.interests }}</div>{% endif %}
                    </div>
                  </div>
                  <div class="mt-3 d-flex gap-2">
                    <a class="btn btn-sm btn-outline-primary" href="{{ url_for('profile_view', username=u.username) }}">View Profile</a>
                    <a class="btn btn-sm btn-primary" href="{{ url_for('messages_thread', username=u.username) }}">Say Hi</a>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Your profile card + quick edit -->
    <div class="col-lg-5">
      <div class="card p-3">
        <div class="d-flex align-items-center gap-3">
          <img src="{{ me.avatar_url or 'https://via.placeholder.com/80' }}" width="80" height="80" class="rounded-circle object-cover" alt="">
          <div>
            <div class="fw-semibold">{{ me.username }}</div>
            {% if me.school %}<div class="text-muted small">{{ me.school }}</div>{% endif %}
            {% if me.interests %}<div class="text-muted small">Interests: {{ me.interests }}</div>{% endif %}
          </div>
        </div>
        <div class="mt-3 d-flex gap-2">
          <a class="btn btn-outline-primary btn-sm" href="{{ url_for('profile_edit') }}"><i class="bi bi-pencil me-1"></i>Edit Profile</a>
          <a class="btn btn-outline-primary btn-sm" href="{{ url_for('people') }}"><i class="bi bi-people me-1"></i>People</a>
        </div>
      </div>

      <!-- Upcoming highlight (compact) -->
      <div class="card p-3 mt-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h6 class="mb-0">Upcoming events (your RSVPs)</h6>
          <a class="small link-muted" href="{{ url_for('events') }}">Explore more</a>
        </div>
        {% set any_upcoming = (upcoming_internal and upcoming_internal|length) or (upcoming_external and upcoming_external|length) %}
        {% if not any_upcoming %}
          <div class="text-muted">No RSVPs yet. Tap ‚ÄúI‚Äôm going‚Äù on an event to see it here.</div>
        {% else %}
          <ul class="list-unstyled mb-0">
            {% for e in upcoming_internal %}
              <li class="py-2 d-flex align-items-start gap-3 border-bottom border-opacity-10">
                <img src="{{ e.image_url or 'https://via.placeholder.com/56x56' }}" width="56" height="56" class="rounded object-cover" alt="">
                <div class="flex-grow-1">
                  <div class="small fw-semibold">{{ e.title }}</div>
                  <div class="text-muted small">{{ e.start | datetimeformat_safe }} ¬∑ {{ e.location_text }}</div>
                  <a class="small link-muted" href="{{ url_for('view_user_event', event_id=e.id) }}">View</a>
                </div>
              </li>
            {% endfor %}
            {% for x in upcoming_external %}
              <li class="py-2 d-flex align-items-start gap-3 {% if not loop.last %}border-bottom border-opacity-10{% endif %}">
                <img src="{{ x.image_url or 'https://via.placeholder.com/56x56' }}" width="56" height="56" class="rounded object-cover" alt="">
                <div class="flex-grow-1">
                  <div class="small fw-semibold">{{ x.name }}</div>
                  <div class="text-muted small">{{ x.start | datetimeformat_safe }}{% if x.venue %} ¬∑ {{ x.venue }}{% endif %}{% if x.city %} ¬∑ {{ x.city }}{% endif %}</div>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    </div>

  </div>

  <!-- Event discovery preview -->
  <div class="card p-3 mt-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Discover events</h5>
      <a class="small link-muted" href="{{ url_for('events') }}">See all</a>
    </div>
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-3">
      <!-- Minimal placeholder... live previews coming, pass a few public events into this template and loop. -->
      <div class="col">
        <div class="card p-2">
          <img class="rounded object-cover w-100" style="aspect-ratio:16/9" src="https://images.unsplash.com/photo-1514525253161-7a46d19cd819?q=80&w=1200&auto=format&fit=crop" alt="">
          <div class="p-2 small text-muted">Popular this week</div>
        </div>
      </div>
      <div class="col">
        <div class="card p-2">
          <img class="rounded object-cover w-100" style="aspect-ratio:16/9" src="https://images.unsplash.com/photo-1499364615650-ec38552f4f34?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8bGl2ZSUyMG11c2ljfGVufDB8fDB8fHww" alt="">
          <div class="p-2 small text-muted">Live music</div>
        </div>
      </div>
      <div class="col d-none d-lg-block">
        <div class="card p-2">
          <img class="rounded object-cover w-100" style="aspect-ratio:16/9" src="https://images.unsplash.com/photo-1524178232363-1fb2b075b655?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="">
          <div class="p-2 small text-muted">Meetups & tech</div>
        </div>
      </div>
      <div class="col d-none d-lg-block">
        <div class="card p-2">
          <img class="rounded object-cover w-100" style="aspect-ratio:16/9" src="https://images.unsplash.com/photo-1625456824710-dd9eac85d5df?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8b3V0ZG9vcnMlMjBhY3Rpdml0eXxlbnwwfHwwfHx8MA%3D%3D" alt="">
          <div class="p-2 small text-muted">Outdoors</div>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}
