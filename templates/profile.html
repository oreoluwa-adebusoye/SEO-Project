{% extends "layout.html" %}
{% block title %}{{ user.username }} | Profile{% endblock %}
{% block content %}

<div class="container py-4">

  <!-- Header card -->
  <div class="card p-0 overflow-hidden mb-4">
    <!-- Banner -->
    <div class="profile-banner"></div>

    <!-- Top section -->
    <div class="p-3 p-lg-4">
      <div class="d-flex align-items-center gap-3">
        <img
          src="{{ user.avatar_url or 'https://via.placeholder.com/108' }}"
          width="108" height="108"
          class="rounded-circle object-cover profile-avatar"
          alt="{{ user.username }}"
        />
        <div class="flex-grow-1">
          <h3 class="mb-1">{{ user.username }}</h3>
          <div class="text-muted small d-flex flex-wrap gap-3">
            {% if user.school %}<span><i class="bi bi-mortarboard"></i> {{ user.school }}</span>{% endif %}
            {% if user.age %}<span><i class="bi bi-cake"></i> {{ user.age }} yrs</span>{% endif %}
            <span class="d-none d-sm-inline"><i class="bi bi-calendar3"></i> Joined {{ user.created_at.strftime('%b %Y') }}</span>
          </div>
        </div>

        <div class="d-none d-md-flex gap-2">
          {% if current_user.is_authenticated and current_user.id != user.id %}
            <a class="btn btn-outline-primary" href="{{ url_for('messages_thread', username=user.username) }}">
              <i class="bi bi-chat-dots me-1"></i> Message
            </a>
          {% endif %}
          {% if can_edit %}
            <a class="btn btn-primary" href="{{ url_for('profile_edit') }}">
              <i class="bi bi-pencil me-1"></i> Edit Profile
            </a>
          {% endif %}
        </div>
      </div>

      <!-- Actions (mobile) -->
      <div class="d-flex d-md-none gap-2 mt-3">
        {% if current_user.is_authenticated and current_user.id != user.id %}
          <a class="btn btn-outline-primary flex-fill" href="{{ url_for('messages_thread', username=user.username) }}">
            <i class="bi bi-chat-dots me-1"></i> Message
          </a>
        {% endif %}
        {% if can_edit %}
          <a class="btn btn-primary flex-fill" href="{{ url_for('profile_edit') }}">
            <i class="bi bi-pencil me-1"></i> Edit
          </a>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="row g-4">
    <!-- Left: About & Interests -->
    <div class="col-lg-8">
      <div class="card p-3 p-lg-4 mb-4">
        <h5 class="mb-3">About</h5>
        {% if user.ice_breaker_question %}
          <div class="mb-2"><span class="text-muted small">Ice breaker:</span> {{ user.ice_breaker_question }}</div>
        {% endif %}
        {% if user.interests %}
          <div class="mt-3">
            <div class="text-muted small mb-2">Interests</div>
            <div class="d-flex flex-wrap gap-2">
              {% for tag in user.interests.split(',') %}
                {% set t = tag.strip() %}
                {% if t %}
                  <span class="chip">{{ t }}</span>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        {% else %}
          <div class="text-muted">No interests listed yet.</div>
        {% endif %}
      </div>

      <!-- Optional: Recent activity placeholder -->
      <div class="card p-3 p-lg-4">
        <h5 class="mb-3">Recent activity</h5>
        <div class="text-muted">Coming soon — events you’ve joined and messages sent.</div>
      </div>
    </div>

    <!-- Right: Quick info -->
    <div class="col-lg-4">
      <div class="card p-3 p-lg-4">
        <h6 class="text-muted mb-2">Quick info</h6>
        <ul class="list-unstyled mb-0 small">
          <li class="mb-2 d-flex align-items-center gap-2">
            <i class="bi bi-envelope-open text-primary"></i>
            <span>{{ user.email }}</span>
          </li>
          {% if user.school %}
          <li class="mb-2 d-flex align-items-center gap-2">
            <i class="bi bi-mortarboard text-primary"></i>
            <span>{{ user.school }}</span>
          </li>
          {% endif %}
          {% if user.age %}
          <li class="mb-2 d-flex align-items-center gap-2">
            <i class="bi bi-cake text-primary"></i>
            <span>{{ user.age }} years old</span>
          </li>
          {% endif %}
          <li class="d-flex align-items-center gap-2">
            <i class="bi bi-calendar3 text-primary"></i>
            <span>Member since {{ user.created_at.strftime('%b %d, %Y') }}</span>
          </li>
        </ul>
      </div>

      {% if can_edit %}
      <div class="card p-3 p-lg-4 mt-3">
        <h6 class="text-muted mb-2">Pro tip</h6>
        <div class="small text-muted">
          Add an <strong>avatar URL</strong> and a few <strong>interests</strong> (comma-separated) so people are more likely to say hi.
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}
