{% extends "layout.html" %}
{% block title %}{% if create_mode %}Create Event{% else %}Event Details{% endif %}{% endblock %}
{% block content %}

<div class="container py-4">

  {% if create_mode %}
    <h3 class="mb-3">Create Event</h3>
    <div class="card p-4">
      <form method="POST">
        <div class="mb-3">
          <label class="form-label">Title</label>
          <input name="title" class="form-control" required>
        </div>

        <div class="mb-3">
          <label class="form-label">Start (date & time)</label>
          <input type="datetime-local" name="start" class="form-control" required>
        </div>

        <div class="mb-3">
          <label class="form-label">Location</label>
          <input name="location_text" class="form-control" required>
        </div>

        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea name="description" class="form-control" rows="4"></textarea>
        </div>

        <div class="mb-3">
          <label class="form-label">Image URL</label>
          <input type="url" name="image_url" class="form-control" placeholder="https://example.com/cover.jpg">
        </div>

        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" name="is_private" id="is_private">
          <label class="form-check-label" for="is_private">Private (invite-only)</label>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">Create</button>
          <a href="{{ url_for('events') }}" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>

  {% else %}
    {# VIEW MODE: safe to use `event.*` here #}
    <div class="card p-4">
      {% if event.image_url %}
        <img src="{{ event.image_url }}" class="img-fluid rounded mb-3" alt="{{ event.title }}" style="max-height:360px; object-fit:cover; width:100%;">
      {% endif %}

      <h2 class="card-title mb-2">{{ event.title }}</h2>
      <p class="text-muted mb-1"><strong>Date:</strong> {{ event.start | datetimeformat_safe }}</p>
      <p class="text-muted"><strong>Location:</strong> {{ event.location_text }}</p>
      {% if event.is_private %}<span class="badge badge-soft">Private</span>{% endif %}

      {% if event.description %}
        <div class="mt-3">
          <h5>Description</h5>
          <p class="mb-0">{{ event.description }}</p>
        </div>
      {% endif %}

      <div class="mt-4 d-flex flex-wrap gap-2">
        <a href="{{ url_for('events') }}" class="btn btn-secondary">Back to Events</a>

        {% if current_user.is_authenticated %}
          <form method="POST" action="{{ url_for('rsvp_internal', event_id=event.id) }}" class="d-inline">
            <button class="btn btn-primary">I’m going</button>
          </form>
          <form method="POST" action="{{ url_for('unrsvp_internal', event_id=event.id) }}" class="d-inline">
            <button class="btn btn-outline-secondary">Can’t go</button>
          </form>
        {% endif %}
      </div>
    </div>
  {% endif %}

</div>

{% endblock %}
