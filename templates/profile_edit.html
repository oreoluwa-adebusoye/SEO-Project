{% extends "layout.html" %}
{% block title %}Edit Profile | LinkUp{% endblock %}
{% block content %}

<div class="container py-4">
  <div class="row g-4">
    <div class="col-lg-8">
      <div class="card p-4">
        <h4 class="mb-3">Edit profile</h4>

        <form method="POST">
          <div class="row g-3">
            <!-- Avatar URL -->
            <div class="col-12">
              <label class="form-label">Avatar URL</label>
              <input name="avatar_url" type="url" class="form-control"
                     placeholder="https://example.com/me.jpg"
                     value="{{ user.avatar_url or '' }}"
                     oninput="previewAvatar(this.value)">
              <div class="form-text">Paste an image link. PNG/JPG recommended.</div>
            </div>

            <!-- Name (read-only for now, since signup set it) -->
            <div class="col-md-6">
              <label class="form-label">Name</label>
              <input class="form-control" value="{{ user.username }}" disabled>
              <div class="form-text">Name is set at signup.</div>
            </div>

            <!-- Age -->
            <div class="col-md-3">
              <label class="form-label">Age</label>
              <input name="age" type="number" min="0" class="form-control" value="{{ user.age or '' }}" placeholder="e.g. 20">
            </div>

            <!-- School -->
            <div class="col-md-6">
              <label class="form-label">School</label>
              <input name="school" class="form-control" placeholder="e.g. NYU"
                     value="{{ user.school or '' }}">
            </div>

            <!-- Interests -->
            <div class="col-12">
              <label class="form-label">Interests (comma-separated)</label>
              <input name="interests" class="form-control"
                     placeholder="hiking, ai meetups, photography"
                     value="{{ user.interests or '' }}">
              <div class="form-text">Weâ€™ll show these as tags on your profile.</div>
            </div>
          </div>

          <div class="d-flex gap-2 mt-4">
            <button class="btn btn-primary" type="submit"><i class="bi bi-check2 me-1"></i> Save changes</button>
            <a class="btn btn-secondary" href="{{ url_for('profile_view', username=user.username) }}">Cancel</a>
          </div>
        </form>
      </div>
    </div>

    <!-- Live Preview -->
    <div class="col-lg-4">
      <div class="card p-4 text-center">
        <img id="avatarPreview"
             src="{{ user.avatar_url or 'https://via.placeholder.com/160' }}"
             width="160" height="160"
             class="rounded-circle object-cover profile-avatar mx-auto mb-3"
             alt="Avatar preview">
        <div class="fw-semibold">{{ user.username }}</div>
        {% if user.school %}<div class="text-muted small">{{ user.school }}</div>{% endif %}
        <div class="mt-3 d-flex flex-wrap gap-2 justify-content-center">
          {% if user.interests %}
            {% for tag in user.interests.split(',') %}
              {% set t = tag.strip() %}
              {% if t %}<span class="chip">{{ t }}</span>{% endif %}
            {% endfor %}
          {% else %}
            <span class="text-muted small">Interests will appear here</span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

{% block scripts %}
<script>
  function previewAvatar(url){
    const img = document.getElementById('avatarPreview');
    if(!img) return;
    if(!url){ img.src = 'https://via.placeholder.com/160'; return; }
    img.src = url;
  }
</script>
{% endblock %}
{% endblock %}
